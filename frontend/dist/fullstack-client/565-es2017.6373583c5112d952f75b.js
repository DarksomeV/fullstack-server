"use strict";(self.webpackChunkfullstack_client=self.webpackChunkfullstack_client||[]).push([[565],{4565:function(t,e,i){i.r(e),i.d(e,{CategoriesModule:function(){return B}});var o=i(8583),n=i(1182),s=i(665),r=i(6215),a=i(8939),c=i(639),l=i(1841);let g=(()=>{class t{constructor(t){this._http=t}getAllCategories(){return this._http.get("/api/category")}getCategoryById(t){return this._http.get(`/api/category/${t}`)}createCategory(t,e){const i=new FormData;return e&&i.append("image",e,e.name),i.append("name",t),this._http.post("/api/category",i)}updateCategory(t,e,i){const o=new FormData;return i&&o.append("image",i,i.name),o.append("name",e),this._http.patch(`/api/category/${t}`,o)}deleteCategory(t){return this._http.delete(`/api/category/${t}`)}getPositionsByCategoryId(t){return this._http.get(`/api/position/${t}`)}createPosition(t){return this._http.post("/api/position",t)}updatePosition(t){return this._http.patch(`/api/position/${t._id}`,t)}deletePosition(t){return this._http.delete(`/api/position/${t}`)}}return t.\u0275fac=function(e){return new(e||t)(c.LFG(l.eN))},t.\u0275prov=c.Yz7({token:t,factory:t.\u0275fac}),t})(),p=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-loader"]],decls:10,vars:0,consts:[[1,"row"],[1,"col-12","center"],[1,"preloader-wrapper","active"],[1,"spinner-layer","spinner-red-only"],[1,"circle-clipper","left"],[1,"circle"],[1,"gap-patch"],[1,"circle-clipper","right"]],template:function(t,e){1&t&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"div",2),c.TgZ(3,"div",3),c.TgZ(4,"div",4),c._UZ(5,"div",5),c.qZA(),c.TgZ(6,"div",6),c._UZ(7,"div",5),c.qZA(),c.TgZ(8,"div",7),c._UZ(9,"div",5),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA())},styles:[""]}),t})();const d=function(t){return["/categories",t]};function u(t,e){if(1&t&&(c.TgZ(0,"a",10),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("routerLink",c.VKq(2,d,t._id)),c.xp6(1),c.Oqu(t.name)}}function f(t,e){if(1&t&&(c.TgZ(0,"div",8),c.YNc(1,u,2,4,"a",9),c.qZA()),2&t){const t=c.oxw().ngIf;c.xp6(1),c.Q6J("ngForOf",t)}}function m(t,e){if(1&t&&(c.TgZ(0,"div",5),c.TgZ(1,"div",6),c.YNc(2,f,2,1,"div",7),c.qZA(),c.qZA()),2&t){const t=e.ngIf;c.oxw();const i=c.MAs(8);c.xp6(2),c.Q6J("ngIf",t.length)("ngIfElse",i)}}function h(t,e){1&t&&(c.TgZ(0,"div",11),c._uU(1," \u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0439 "),c.qZA())}function Z(t,e){1&t&&c._UZ(0,"app-loader")}let v=(()=>{class t{constructor(t){this._categoriesService=t,this.isLoading$=new r.X(!0)}ngOnInit(){this.initObservables()}initObservables(){this.categories$=this._categoriesService.getAllCategories().pipe((0,a.x)(()=>this.isLoading$.next(!1)))}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(g))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-categories-page"]],decls:11,vars:6,consts:[[1,"page-title"],["routerLink","/categories/new",1,"waves-effect","waves-light","btn","grey","darken-1"],["class","row",4,"ngIf"],["empty",""],[4,"ngIf"],[1,"row"],[1,"col","s12"],["class","collection",4,"ngIf","ngIfElse"],[1,"collection"],["class","collection-item",3,"routerLink",4,"ngFor","ngForOf"],[1,"collection-item",3,"routerLink"],[1,"center"]],template:function(t,e){1&t&&(c.TgZ(0,"div",0),c.TgZ(1,"h4"),c._uU(2,"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438"),c.qZA(),c.TgZ(3,"button",1),c._uU(4,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e"),c.qZA(),c.qZA(),c.YNc(5,m,3,2,"div",2),c.ALo(6,"async"),c.YNc(7,h,2,0,"ng-template",null,3,c.W1O),c.YNc(9,Z,1,0,"app-loader",4),c.ALo(10,"async")),2&t&&(c.xp6(5),c.Q6J("ngIf",c.lcZ(6,2,e.categories$)),c.xp6(4),c.Q6J("ngIf",c.lcZ(10,4,e.isLoading$)))},directives:[n.rH,o.O5,o.sg,n.yS,p],pipes:[o.Ov],styles:[""]}),t})(),b=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[o.ez]]}),t})();var _=i(3190),q=i(3342),A=i(5917),y=i(9527);const w=["modal"];function T(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"a",23),c.NdJ("click",function(){const e=c.CHM(t).$implicit;return c.oxw(2).onSelectPosition(e)}),c.TgZ(1,"span"),c._uU(2),c.TgZ(3,"strong"),c._uU(4),c.qZA(),c.qZA(),c.TgZ(5,"span",24),c.NdJ("click",function(e){const i=c.CHM(t).$implicit;return c.oxw(2).onDeletePosition(e,i)}),c.TgZ(6,"i",25),c._uU(7,"delete"),c.qZA(),c.qZA(),c.qZA()}if(2&t){const t=e.$implicit;c.xp6(2),c.hij(" ",t.name," "),c.xp6(2),c.hij("",t.cost," uah.")}}function x(t,e){if(1&t&&(c.TgZ(0,"div",21),c.YNc(1,T,8,2,"a",22),c.qZA()),2&t){const t=c.oxw();c.xp6(1),c.Q6J("ngForOf",t.positions)}}function I(t,e){1&t&&(c.TgZ(0,"span"),c._uU(1," \u0418\u043c\u044f \u043f\u043e\u0437\u0438\u0446\u0438\u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c "),c.qZA())}function J(t,e){if(1&t&&(c.TgZ(0,"span",26),c.YNc(1,I,2,0,"span",20),c.qZA()),2&t){const t=c.oxw();c.xp6(1),c.Q6J("ngIf",t.form.get("name").errors.required)}}function k(t,e){1&t&&(c.TgZ(0,"span"),c._uU(1," \u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u0443\u044e \u0446\u0435\u043d\u0443. \u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 - 1. "),c.qZA())}function U(t,e){if(1&t&&(c.TgZ(0,"span",26),c.YNc(1,k,2,0,"span",20),c.qZA()),2&t){const t=c.oxw();c.xp6(1),c.Q6J("ngIf",t.form.get("cost").errors.min)}}function C(t,e){1&t&&(c.TgZ(0,"div",27),c._uU(1," \u0423 \u0434\u0430\u043d\u043d\u043e\u0439 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438 \u0435\u0449\u0435 \u043d\u0435\u0442 \u043f\u043e\u0437\u0438\u0446\u0438\u0439 "),c.qZA())}function N(t,e){1&t&&c._UZ(0,"app-loader")}const Q=function(t){return{invalid:t}};let S=(()=>{class t{constructor(t,e){this._categoriesService=t,this._fb=e,this.positionId=null,this.isLoading$=new r.X(!0)}ngOnInit(){this.initForm(),this.initObservables()}ngAfterViewInit(){this.modal=y.m.initModal(this.modalRef)}ngOnDestroy(){this.modal.destroy()}onSelectPosition(t){this.positionId=t._id,this.form.patchValue(t),y.m.updateInputs(),this.modal.open()}onAddPosition(){this.positionId=null,this.form.reset(),this.modal.open()}onCancel(){this.modal.close()}onSubmit(){this.form.disable();const t=Object.assign(Object.assign({},this.form.value),{category:this.categoryId});this.positionId?(t._id=this.positionId,this._categoriesService.updatePosition(t).pipe((0,a.x)(()=>{this.form.enable(),this.form.reset(),this.modal.close()})).subscribe(t=>{const e=this.positions.findIndex(e=>e._id===t._id);this.positions[e]=t,y.m.toast("\u041f\u043e\u0437\u0438\u0446\u0438\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430")},({error:t})=>{y.m.toast(null==t?void 0:t.message)})):this._categoriesService.createPosition(t).pipe((0,a.x)(()=>{this.form.enable(),this.form.reset(),this.modal.close()})).subscribe(t=>{this.positions.push(t),y.m.toast("\u041f\u043e\u0437\u0438\u0446\u0438\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0430")},({error:t})=>{y.m.toast(null==t?void 0:t.message)})}onDeletePosition(t,e){t.stopPropagation(),window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u0443 \u043f\u043e\u0437\u0438\u0446\u0438\u044e?")&&this._categoriesService.deletePosition(e._id).subscribe(({message:t})=>{const i=this.positions.findIndex(t=>t._id===e._id);this.positions.splice(i,1),y.m.toast(t)},({error:t})=>{y.m.toast(null==t?void 0:t.message)})}initForm(){this.form=this._fb.group({name:["",s.kI.required],cost:["",[s.kI.required,s.kI.min(1)]]})}initObservables(){this._categoriesService.getPositionsByCategoryId(this.categoryId).pipe((0,a.x)(()=>this.isLoading$.next(!1))).subscribe(t=>{this.positions=t})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(g),c.Y36(s.qu))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-position-form"]],viewQuery:function(t,e){if(1&t&&c.Gf(w,5),2&t){let t;c.iGM(t=c.CRH())&&(e.modalRef=t.first)}},inputs:{categoryId:"categoryId"},decls:33,vars:16,consts:[[1,"row"],[1,"col","s12"],[1,"page-subtitle"],[1,"waves-effect","waves-light","btn","grey","darken-1","btn-small","modal-trigger",3,"click"],["class","collection",4,"ngIf","ngIfElse"],[3,"formGroup","ngSubmit"],[1,"modal"],["modal",""],[1,"modal-content"],[1,"mb1"],[1,"input-field"],["id","pos-name","type","text","formControlName","name",3,"ngClass"],["for","pos-name"],["class","helper-text red-text",4,"ngIf"],["id","pos-cost","type","number","min","1","formControlName","cost",3,"ngClass"],["for","pos-cost"],[1,"modal-footer"],["type","button",1,"modal-action","waves-effect","waves-black","btn-flat",3,"disabled","click"],["type","submit",1,"modal-action","btn","waves-effect",3,"disabled"],["empty",""],[4,"ngIf"],[1,"collection"],["class","collection-item collection-item-icon modal-trigger",3,"click",4,"ngFor","ngForOf"],[1,"collection-item","collection-item-icon","modal-trigger",3,"click"],[3,"click"],[1,"material-icons"],[1,"helper-text","red-text"],[1,"center"]],template:function(t,e){if(1&t&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"div",2),c.TgZ(3,"h4"),c._uU(4,"\u041f\u043e\u0437\u0438\u0446\u0438\u0438:"),c.qZA(),c.TgZ(5,"button",3),c.NdJ("click",function(){return e.onAddPosition()}),c._uU(6," \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u0437\u0438\u0446\u0438\u044e "),c.qZA(),c.qZA(),c.YNc(7,x,2,1,"div",4),c.qZA(),c.qZA(),c.TgZ(8,"form",5),c.NdJ("ngSubmit",function(){return e.onSubmit()}),c.TgZ(9,"div",6,7),c.TgZ(11,"div",8),c.TgZ(12,"h4",9),c._uU(13,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u0437\u0438\u0446\u0438\u044e"),c.qZA(),c.TgZ(14,"div",10),c._UZ(15,"input",11),c.TgZ(16,"label",12),c._uU(17,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"),c.qZA(),c.YNc(18,J,2,1,"span",13),c.qZA(),c.TgZ(19,"div",10),c._UZ(20,"input",14),c.TgZ(21,"label",15),c._uU(22,"\u0426\u0435\u043d\u0430"),c.qZA(),c.YNc(23,U,2,1,"span",13),c.qZA(),c.qZA(),c.TgZ(24,"div",16),c.TgZ(25,"button",17),c.NdJ("click",function(){return e.onCancel()}),c._uU(26,"\u041e\u0442\u043c\u0435\u043d\u0430"),c.qZA(),c.TgZ(27,"button",18),c._uU(28,"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.YNc(29,C,2,0,"ng-template",null,19,c.W1O),c.YNc(31,N,1,0,"app-loader",20),c.ALo(32,"async")),2&t){const t=c.MAs(30);c.xp6(7),c.Q6J("ngIf",null==e.positions?null:e.positions.length)("ngIfElse",t),c.xp6(1),c.Q6J("formGroup",e.form),c.xp6(7),c.Q6J("ngClass",c.VKq(12,Q,e.form.get("name").invalid&&e.form.get("name").touched)),c.xp6(3),c.Q6J("ngIf",e.form.get("name").invalid&&e.form.get("name").touched),c.xp6(2),c.Q6J("ngClass",c.VKq(14,Q,e.form.get("cost").invalid&&e.form.get("cost").touched)),c.xp6(3),c.Q6J("ngIf",e.form.get("cost").invalid&&e.form.get("cost").touched),c.xp6(2),c.Q6J("disabled",e.form.disabled),c.xp6(2),c.Q6J("disabled",e.form.invalid||e.form.disabled),c.xp6(4),c.Q6J("ngIf",c.lcZ(32,10,e.isLoading$))}},directives:[o.O5,s._Y,s.JL,s.sg,s.Fj,s.JJ,s.u,o.mk,s.qQ,s.wV,o.sg,p],pipes:[o.Ov],styles:[""]}),t})();const Y=["input"];function O(t,e){if(1&t){const t=c.EpF();c.TgZ(0,"button",17),c.NdJ("click",function(){return c.CHM(t),c.oxw().deleteCategory()}),c.TgZ(1,"i",2),c._uU(2,"delete"),c.qZA(),c.qZA()}}function L(t,e){1&t&&(c.TgZ(0,"span"),c._uU(1," \u0418\u043c\u044f \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c "),c.qZA())}function P(t,e){if(1&t&&(c.TgZ(0,"span",18),c.YNc(1,L,2,0,"span",19),c.qZA()),2&t){const t=c.oxw();c.xp6(1),c.Q6J("ngIf",t.form.get("name").errors.required)}}function F(t,e){if(1&t&&(c.TgZ(0,"div",20),c._UZ(1,"img",21),c.qZA()),2&t){const t=c.oxw();c.xp6(1),c.Q6J("src",t.imagePreview,c.LSH)}}function $(t,e){if(1&t&&c._UZ(0,"app-position-form",22),2&t){const t=c.oxw();c.Q6J("categoryId",t.category._id)}}const M=function(){return["/categories"]},j=function(t){return{invalid:t}};let G=(()=>{class t{constructor(t,e,i,o){this._route=t,this._router=e,this._categoriesService=i,this._fb=o,this.isNew=!0}ngOnInit(){this.initForm(),this.form.disable(),this._route.params.pipe((0,_.w)(t=>t.id?(this.isNew=!1,this._categoriesService.getCategoryById(t.id)):(0,A.of)(null))).subscribe(t=>{t&&(this.category=t,this.form.patchValue(t),y.m.updateInputs(),this.imagePreview=t.imageSrc),this.form.enable()},({error:t})=>{y.m.toast(null==t?void 0:t.message)})}triggerClick(){this.imageInput.nativeElement.click()}fileUpload(t){const e=t.target.files[0];this.image=e;const i=new FileReader;i.onload=()=>{this.imagePreview=i.result},i.readAsDataURL(e)}onSubmit(){let t;this.form.disable(),t=this.isNew?this._categoriesService.createCategory(this.form.value.name,this.image).pipe((0,q.b)(t=>{this._router.navigate(["../categories",t._id])})):this._categoriesService.updateCategory(this.category._id,this.form.value.name,this.image),t.subscribe(t=>{this.category=t,y.m.toast("\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b"),this.form.enable()},({error:t})=>{y.m.toast(null==t?void 0:t.message),this.form.enable()})}deleteCategory(){window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e?")&&this._categoriesService.deleteCategory(this.category._id).subscribe(({message:t})=>{y.m.toast(t)},({error:t})=>{y.m.toast(null==t?void 0:t.message)},()=>{this._router.navigate(["/categories"])})}initForm(){this.form=this._fb.group({name:["",s.kI.required]})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(n.gz),c.Y36(n.F0),c.Y36(g),c.Y36(s.qu))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-categories-form"]],viewQuery:function(t,e){if(1&t&&c.Gf(Y,5),2&t){let t;c.iGM(t=c.CRH())&&(e.imageInput=t.first)}},decls:28,vars:13,consts:[[1,"page-title"],[3,"routerLink"],[1,"material-icons"],["class","btn btn-small red",3,"click",4,"ngIf"],[1,"row"],[1,"col","s12","l6",3,"formGroup","ngSubmit"],[1,"input-field"],["id","name","type","text","formControlName","name",3,"ngClass"],["for","name"],["class","helper-text red-text",4,"ngIf"],["type","file",1,"dn",3,"change"],["input",""],["type","button",1,"waves-effect","waves-light","btn","orange","lighten-2","mb2",3,"disabled","click"],[1,"material-icons","left"],["type","submit",1,"waves-effect","waves-light","btn",3,"disabled"],["class","col s12 l4 center",4,"ngIf"],[3,"categoryId",4,"ngIf"],[1,"btn","btn-small","red",3,"click"],[1,"helper-text","red-text"],[4,"ngIf"],[1,"col","s12","l4","center"],[1,"responsive-img",2,"height","200px",3,"src"],[3,"categoryId"]],template:function(t,e){1&t&&(c.TgZ(0,"div",0),c.TgZ(1,"h4"),c.TgZ(2,"a",1),c._uU(3,"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438"),c.qZA(),c.TgZ(4,"i",2),c._uU(5,"keyboard_arrow_right"),c.qZA(),c._uU(6),c.qZA(),c.TgZ(7,"span"),c.YNc(8,O,3,0,"button",3),c.qZA(),c.qZA(),c.TgZ(9,"div",4),c.TgZ(10,"form",5),c.NdJ("ngSubmit",function(){return e.onSubmit()}),c.TgZ(11,"div",6),c._UZ(12,"input",7),c.TgZ(13,"label",8),c._uU(14,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"),c.qZA(),c.YNc(15,P,2,1,"span",9),c.qZA(),c.TgZ(16,"div"),c.TgZ(17,"input",10,11),c.NdJ("change",function(t){return e.fileUpload(t)}),c.qZA(),c.TgZ(19,"button",12),c.NdJ("click",function(){return e.triggerClick()}),c.TgZ(20,"i",13),c._uU(21,"backup"),c.qZA(),c._uU(22," \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 "),c.qZA(),c.qZA(),c.TgZ(23,"div"),c.TgZ(24,"button",14),c._uU(25," \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f "),c.qZA(),c.qZA(),c.qZA(),c.YNc(26,F,2,1,"div",15),c.qZA(),c.YNc(27,$,1,1,"app-position-form",16)),2&t&&(c.xp6(2),c.Q6J("routerLink",c.DdM(10,M)),c.xp6(4),c.hij(" ",e.isNew?"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c":"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"," \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e "),c.xp6(2),c.Q6J("ngIf",!e.isNew),c.xp6(2),c.Q6J("formGroup",e.form),c.xp6(2),c.Q6J("ngClass",c.VKq(11,j,e.form.get("name").invalid&&e.form.get("name").touched)),c.xp6(3),c.Q6J("ngIf",e.form.get("name").invalid&&e.form.get("name").touched),c.xp6(4),c.Q6J("disabled",e.form.disabled),c.xp6(5),c.Q6J("disabled",e.form.invalid||e.form.disabled),c.xp6(2),c.Q6J("ngIf",e.imagePreview),c.xp6(1),c.Q6J("ngIf",null==e.category?null:e.category._id))},directives:[n.yS,o.O5,s._Y,s.JL,s.sg,s.Fj,s.JJ,s.u,o.mk,S],styles:[".dn[_ngcontent-%COMP%]{display:none}"]}),t})();const V=[{path:"",component:v},{path:"new",component:G},{path:":id",component:G}];let B=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({providers:[g],imports:[[o.ez,b,n.Bz.forChild(V),s.UX]]}),t})()}}]);